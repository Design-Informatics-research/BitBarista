{% extends "index.html" %}
{% block content %}
<div id="message">{{ message }}</div>

<div class="row" id="offers">
  <div class="col-sm-offset-1 col-sm-10">

    <div class="row">
      <div class="col-sm-12">
        <div class="touch-button" style="">

          <div class="row">
            <div class="col-sm-6">
              <div id="qrcode" style="float:left; margin-right:3%;"></div>
              <p style="font-size:2vw;">Step 1: Get your smartphone to display a QR code with <i>your</i> bitcoin address!</p>
              <p style="font-size:2vw;">Step 2: Hold it under the camera on the right.</p>
            </div>

            <div class="col-sm-6">
              <img id="scanexample" src="/assets/scanexample.gif"/>
              <div id="scanmessage"></div>
              <div style="clear:both;"></div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}

{% block javascript %}
<script>
$(document).ready(function(){
  
  var animateBlink = function(){
    $('.blink').each(function() {
      var elem = $(this);
      setInterval(function() {
        if (elem.css('visibility') == 'hidden') {
          elem.css('visibility', 'visible');
        } else {
          elem.css('visibility', 'hidden');
        }
    }, 100);
    });
  };

  $('#scanexample').click(function(){
    $.ajax({ 
      url: "http://localhost:5000/qr/",
      dataType: "json",
      success: function(data){
        $("#scanexample").hide();
        $("#scanmessage").replaceWith('<div id="scanmessage">Paying address: '+data['address']+'<span class="blink">...</span></div>');
        animateBlink();
      },
      error: function(data){
        $("#scanmessage").replaceWith('<div id="scanmessage">Couldn\'t scan QR code, please try again.</div>');
      },
      complete: function(data){}
    });
  });

  setTimeout(function(){ 
    $('#message').fadeOut();
  }, 2599);

});
</script>
{% endblock %}
</div>
